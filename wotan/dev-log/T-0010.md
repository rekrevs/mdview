# T-0010: Prototype MarkdownView to validate as MarkdownUI replacement

**Status**: BLOCKED
**Phase**: —
**Blocked by**: T-0009 (planning/analysis must complete first)

## Context

Based on T-0009 analysis, MarkdownView (LiYanan2004) is the recommended path forward for adding LaTeX math support. Before fully committing to replacing MarkdownUI, we need to validate that MarkdownView:

1. Works correctly on macOS
2. Supports our existing features (or has equivalents)
3. Math rendering actually works (inline + block)
4. Performance is acceptable

This is a spike/prototype task - build a minimal test to validate the approach before full migration.

## Acceptance Criteria

- [ ] MarkdownView compiles and runs on macOS 13+
- [ ] Basic markdown renders (headings, lists, code blocks, tables)
- [ ] Inline math `$E = mc^2$` renders correctly
- [ ] Block math `$$\int_0^\infty e^{-x^2} dx$$` renders correctly
- [ ] Math in code blocks does NOT render (AST-aware)
- [ ] Local images can be loaded
- [ ] Document zoom can be achieved (font scaling or similar)
- [ ] Performance acceptable for test-math.md

## Validation Approach

1. Create a separate test target or branch
2. Add MarkdownView dependency
3. Build minimal ContentView using MarkdownView
4. Test with existing markdown files + test-math.md
5. Document any missing features or issues

## Feature Mapping (MarkdownUI → MarkdownView)

| Current Feature | MarkdownUI API | MarkdownView Equivalent | Status |
|-----------------|----------------|------------------------|--------|
| Basic markdown | `Markdown(text)` | `MarkdownView(text)` | TBD |
| Local images | `LocalFileImageProvider` | `MarkdownImageRenderer` protocol | TBD |
| Zoom/theming | `markdownTheme(scaledTheme)` | `.font()` modifiers | TBD |
| Link handling | `.environment(\.openURL)` | TBD | TBD |
| Text selection | `.textSelection(.enabled)` | Built-in? | TBD |

## Verification Plan

### Hard Endpoints
- [ ] `swift build` — compiles with MarkdownView
- [ ] App opens test-math.md and renders math

### Evidence to Collect
- [ ] Screenshot: inline math renders
- [ ] Screenshot: block math renders
- [ ] Screenshot: math in code block does NOT render
- [ ] Screenshot: existing CLAUDE.md renders correctly

## Implementation Notes

- Removed SwiftMath files (MathParser.swift, MathView.swift)
- Reverted ContentView.swift to original state
- Updated Package.swift to use MarkdownView

## Obstacles

### BLOCKER: `#Preview` macro fails on command-line SPM builds

**Error:**
```
external macro implementation type 'PreviewsMacros.SwiftUIView' could not be found
for macro 'Preview(_:body:)'; plugin for module 'PreviewsMacros' not found
```

**Root cause:**
- SwiftDraw (dependency of LaTeXSwiftUI → MathJaxSwift) uses `#Preview` macro
- MarkdownView 2.6.0 also uses `#Preview` in some files
- `#Preview` requires Xcode's PreviewsMacros module which isn't available in command-line SPM builds

**Affected dependency chain:**
```
MarkdownView → LaTeXSwiftUI → MathJaxSwift → SwiftDraw
                                              ↑ has #Preview
```

**Attempted workarounds:**
1. MarkdownView 2.6.0 (latest) - fails in both MarkdownView and SwiftDraw
2. MarkdownView 2.0.0 (older) - fails in SwiftDraw only
3. Release build (`swift build -c release`) - same failure
4. xcodebuild - requires Xcode installation (not available)

### Options to Proceed

1. **Install Xcode** - Would enable PreviewsMacros module
2. **Fork dependencies** - Remove `#Preview` from SwiftDraw and MarkdownView
3. **File upstream issues** - Ask maintainers to wrap `#Preview` in `#if DEBUG`
4. **Abandon MarkdownView** - Use different approach (Textual, custom renderer)
5. **Wait** - This is a known SPM issue; may be fixed in future Swift/SPM versions

## Evidence

(To be filled during verification)

## Outcome

(To be filled on completion - GO/NO-GO decision for full migration)

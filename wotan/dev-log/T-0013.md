# T-0013: Analyze and fix spacing around inline math

**Status**: ONGOING
**Phase**: PLANNING

## Context

After implementing the custom markdown renderer with SwiftMath (T-0012), inline math renders correctly but the spacing/flow around it is awkward. For example, text like "and it's beautiful" after an inline equation doesn't flow naturally with the surrounding text.

The issue is visible in test-math.md where inline math like `$x = \frac{-b \pm \sqrt{b^2-4ac}}{2a}$` appears to disrupt the text baseline and flow.

## Acceptance Criteria

- [ ] Inline math aligns properly with surrounding text baseline
- [ ] Text before and after inline math flows naturally (no awkward breaks)
- [ ] Spacing between inline math and adjacent text is consistent
- [ ] Block math remains centered and separate from text flow

## Verification Plan

(To be filled during PLANNING)

### Hard Endpoints
Commands that must exit 0:
- [ ] `swift build` â€” project compiles

### Evidence to Collect
- [ ] Screenshot showing improved inline math flow

## Approach

### Root Cause

The `WrappingHStack` custom layout places all subviews at `y=0` (top-aligned). When mixing:
- `SwiftUI.Text` (has baseline information)
- `MathView` (NSViewRepresentable, different height)

They don't align on the text baseline, causing awkward spacing.

### Solution

Modify `WrappingHStack` to align items within each row by their **lastTextBaseline** instead of top edge. This requires:

1. Query each subview's `firstTextBaseline` via `LayoutSubview.dimensions`
2. Within each row, find the maximum baseline offset
3. Place each subview so baselines align

For MathView (NSViewRepresentable), we need to expose baseline information via `alignmentGuide(.firstTextBaseline)`.

### Alternative Considered

Use a single `Text` view with inline rendering - but SwiftUI.Text can't embed NSView (MathView), so we need the layout approach.

## Implementation Notes

## Obstacles

## Evidence

## Outcome


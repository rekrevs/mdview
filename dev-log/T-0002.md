# T-0002: Fix: double-clicked file opens in existing window showing old content

**Status**: DONE
**Phase**: VERIFYING
**After**: —
**Before**: —

## Context

When double-clicking a .md file in Finder, the app opens but shows the previously opened document instead of the double-clicked file. The app needs to handle the file open event from macOS and load the correct document.

## Acceptance Criteria

- [x] Double-clicking a .md file in Finder opens that file's content
- [x] If app is already running, double-clicking opens the new file (not the old one)
- [x] File > Open still works correctly

## Verification Plan

### Tests to Create
| Test | Proves | Status |
|------|--------|--------|
| Manual: Double-click .md file | Opens correct content | - |
| Manual: App running, double-click another .md | Shows new file | - |

### Regression Check
```
swift build
```

### Manual Verification
- [ ] Double-click a .md file when app is not running
- [ ] Double-click a different .md file when app is already open

## Approach

The current app uses a simple `WindowGroup` which doesn't handle file open events from macOS.
When a user double-clicks a .md file, macOS sends an `openURL` event to the app.

**Solution**: Add `.onOpenURL` modifier to handle file URLs passed by macOS.

1. Add `.onOpenURL { url in appState.loadFile(url) }` to the WindowGroup content
2. This will intercept file open events from Finder and load the correct file

This is a minimal change - just one line added to mdviewApp.swift.

## Implementation Notes

### PLANNING
- Analyzed current code: WindowGroup without file handling
- macOS sends openURL events when files are double-clicked
- Solution: Add .onOpenURL modifier to ContentView in WindowGroup
- Minimal change: 1 line addition

### TESTING_RED

### IMPLEMENTING
- Initial attempt: Added `.onOpenURL` handler - but all windows shared same AppState
- Root cause: Single shared AppState meant all windows updated together
- Final fix: Switched to `DocumentGroup(viewing: MarkdownDocument.self)` architecture
- Created MarkdownDocument.swift (FileDocument conformance)
- Simplified mdviewApp.swift to use DocumentGroup
- Updated ContentView to accept document directly (no shared state)

### TESTING_GREEN

### REFACTORING

### DEBUGGING

## Obstacles

## Evidence

- User confirmed: two windows open, each showing correct different content
- Double-clicking additional files opens them in separate windows

## Outcome

Switched from shared-state WindowGroup to DocumentGroup(viewing:) architecture.
Each file now opens in its own independent window with its own document state.

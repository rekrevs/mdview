# T-0007: Add find in document with Cmd+F

**Status**: DEFERRED
**Phase**: PLANNING
**After**: —
**Before**: —

## Context

Users need to search for text within long markdown documents. Cmd+F is the standard macOS shortcut for find. The search should highlight matches and allow navigation between them.

## Acceptance Criteria

- [ ] Cmd+F opens a search bar/field
- [ ] Typing in search field highlights matching text
- [ ] Enter or Cmd+G goes to next match
- [ ] Shift+Enter or Cmd+Shift+G goes to previous match
- [ ] Escape closes the search bar
- [ ] Match count is displayed (e.g., "3 of 12")
- [ ] View scrolls to show current match

## Verification Plan

### Tests to Create
| Test | Proves | Status |
|------|--------|--------|
| Manual search test | Find functionality works | - |

### Regression Check
```
swift build
```

### Manual Verification
- [ ] Open a markdown file with repeated words
- [ ] Press Cmd+F, verify search bar appears
- [ ] Type a search term, verify matches highlighted
- [ ] Press Enter, verify navigation to next match
- [ ] Press Escape, verify search bar closes

## Approach

### The Core Problem

MarkdownUI renders markdown as opaque SwiftUI views. We cannot inject highlights into the rendered output without modifying the source. NSTextFinder won't work because MarkdownUI doesn't use NSTextView.

### Options Analyzed

| Approach | Highlighting | Scroll accuracy | Complexity | Standard UX |
|----------|--------------|-----------------|------------|-------------|
| **A. Percentage scroll** | None | ~Approximate | Low | No |
| **B. NSTextView + HTML** | Full | Exact | Medium-High | Yes (NSTextFinder) |
| **C. Block-level split** | Block-level | Good | Medium | Partial |

### Recommended: Option B (NSTextView + HTML)

```
markdown text
    → MarkdownContent.renderHTML()
    → NSAttributedString(html:)
    → NSTextView (wrapped in NSViewRepresentable)
    → NSTextFinder provides standard Cmd+F
```

**Benefits:**
- Standard macOS find bar (NSTextFinder)
- Proper text highlighting
- Cmd+G / Cmd+Shift+G navigation
- Match count displayed automatically
- All keyboard shortcuts work automatically

**Tradeoffs:**
- Replace MarkdownUI's SwiftUI rendering with NSTextView
- Styling will differ from current MarkdownUI theme
- Need to style HTML/NSAttributedString to match desired appearance
- More complex implementation

### Implementation Steps (if proceeding)

1. Create `MarkdownTextView`: NSViewRepresentable wrapping NSTextView
2. Convert markdown → HTML using `MarkdownContent(text).renderHTML()`
3. Convert HTML → NSAttributedString using `NSAttributedString(html:...)`
4. Configure NSTextView with NSTextFinder
5. Add Edit > Find menu items (may get them automatically)
6. Style the NSAttributedString to match current theme (fonts, colors, code blocks)

### Why Deferred

- Significant implementation effort
- Would change rendering approach for entire app
- Current app is functional without find
- Can revisit when find becomes higher priority

## Implementation Notes

### PLANNING

Analyzed MarkdownUI internals:
- `MarkdownContent` has `renderPlainText()` and `renderHTML()` methods
- `blocks: [BlockNode]` is internal, not accessible
- No way to inject highlights into MarkdownUI rendered output
- NSTextFinder requires NSTextView, which MarkdownUI doesn't use

## Obstacles

MarkdownUI's architecture makes text highlighting fundamentally difficult without switching to NSTextView-based rendering.

## Evidence

## Outcome

Deferred pending decision on whether to switch rendering approach.

# T-0004: Add keyboard scrolling (arrows, space, option, command)

**Status**: DONE
**Phase**: DONE
**After**: —
**Before**: —

## Context

The window can be scrolled with trackpad but keyboard navigation is not working. Need to add standard macOS keyboard scrolling support.

## Acceptance Criteria

- [x] ↑/↓ arrows scroll by a small amount (line-by-line)
- [x] Space scrolls down one page, Shift+Space scrolls up one page
- [x] Option+↑/↓ scrolls up/down one page
- [x] ⌘+↑/↓ scrolls to top/bottom of document

## Verification Plan

### Tests to Create
| Test | Proves | Status |
|------|--------|--------|
| Manual: Press ↑/↓ | Small scroll | - |
| Manual: Press Space | Page down | - |
| Manual: Press Shift+Space | Page up | - |
| Manual: Press Option+↑/↓ | Page scroll | - |
| Manual: Press ⌘+↑/↓ | Top/bottom | - |

### Regression Check
```
swift build
```

### Manual Verification
- [ ] Open a long markdown file
- [ ] Test all keyboard combinations

## Approach

SwiftUI's ScrollView doesn't have built-in keyboard support. Need to:

1. Use `ScrollViewReader` with a proxy to programmatically scroll
2. Add `.onKeyPress` or use an NSViewRepresentable to capture key events
3. Calculate scroll amounts based on view height

Alternative approach: Wrap content in an NSScrollView via NSViewRepresentable which has native keyboard support.

**Chosen approach**: Use ScrollViewReader + .onKeyPress modifiers (SwiftUI native, simpler)

## Implementation Notes

### PLANNING
- SwiftUI ScrollView lacks native keyboard scrolling
- Will use ScrollViewReader + .onKeyPress for key handling
- Need to track scroll position with GeometryReader or ScrollViewProxy

### TESTING_RED

### IMPLEMENTING

Initial attempts using pure NSScrollView wrapper failed because NSHostingView has an internal height limit (~10,000px). Long documents were clipped.

Final solution: Keep SwiftUI's native ScrollView (which handles long content correctly) and wrap it in a thin KeyboardCaptureView (NSView) that:
1. Captures keyboard events by becoming first responder
2. Searches the view hierarchy to find the internal NSScrollView
3. Scrolls it directly with animated bounds origin changes

Key bindings implemented:
- ↑/↓: Line scroll (40px)
- Option+↑/↓: Page scroll
- ⌘+↑/↓: Top/bottom
- Space/Shift+Space: Page down/up
- Home/End/PageUp/PageDown: Standard navigation

### TESTING_GREEN

### REFACTORING

### DEBUGGING

## Obstacles

## Evidence

## Outcome

Implemented keyboard scrolling using a hybrid approach: SwiftUI ScrollView for layout/rendering + NSView wrapper for keyboard capture. Works correctly with documents of any length.
